"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var Constants=require("./Constants"),Utils=require("./Utils"),Grammar=require("./Grammar");module.exports=function(){function h(e,t,r,s){var a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{};if(_classCallCheck(this,h),!r)throw new TypeError('missing or invalid "host" parameter');for(var n in this._parameters={},this._headers={},this._scheme=e||Constants.SIP,this._user=t,this._host=r,this._port=s,a)Object.prototype.hasOwnProperty.call(a,n)&&this.setParam(n,a[n]);for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&this.setHeader(o,i[o])}return _createClass(h,null,[{key:"parse",value:function(e){return-1!==(e=Grammar.parse(e,"SIP_URI"))?e:void 0}}]),_createClass(h,[{key:"setParam",value:function(e,t){e&&(this._parameters[e.toLowerCase()]=null==t?null:t.toString())}},{key:"getParam",value:function(e){if(e)return this._parameters[e.toLowerCase()]}},{key:"hasParam",value:function(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}},{key:"deleteParam",value:function(e){if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e)){var t=this._parameters[e];return delete this._parameters[e],t}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"setHeader",value:function(e,t){this._headers[Utils.headerize(e)]=Array.isArray(t)?t:[t]}},{key:"getHeader",value:function(e){if(e)return this._headers[Utils.headerize(e)]}},{key:"hasHeader",value:function(e){if(e)return!!this._headers.hasOwnProperty(Utils.headerize(e))}},{key:"deleteHeader",value:function(e){if(e=Utils.headerize(e),this._headers.hasOwnProperty(e)){var t=this._headers[e];return delete this._headers[e],t}}},{key:"clearHeaders",value:function(){this._headers={}}},{key:"clone",value:function(){return new h(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}},{key:"toString",value:function(){var e=[],t="".concat(this._scheme,":");for(var r in this._user&&(t+="".concat(Utils.escapeUser(this._user),"@")),t+=this._host,!this._port&&0!==this._port||(t+=":".concat(this._port)),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,r)&&(t+=";".concat(r),null!==this._parameters[r]&&(t+="=".concat(this._parameters[r])));for(var s in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,s)){var a=!0,i=!1,n=void 0;try{for(var o,h=this._headers[s][Symbol.iterator]();!(a=(o=h.next()).done);a=!0){var u=o.value;e.push("".concat(s,"=").concat(u))}}catch(e){i=!0,n=e}finally{try{a||null==h.return||h.return()}finally{if(i)throw n}}}return 0<e.length&&(t+="?".concat(e.join("&"))),t}},{key:"toAor",value:function(e){var t="".concat(this._scheme,":");return this._user&&(t+="".concat(Utils.escapeUser(this._user),"@")),t+=this._host,e&&(this._port||0===this._port)&&(t+=":".concat(this._port)),t}},{key:"scheme",get:function(){return this._scheme},set:function(e){this._scheme=e.toLowerCase()}},{key:"user",get:function(){return this._user},set:function(e){this._user=e}},{key:"host",get:function(){return this._host},set:function(e){this._host=e.toLowerCase()}},{key:"port",get:function(){return this._port},set:function(e){this._port=0===e?e:parseInt(e,10)||null}}]),h}();